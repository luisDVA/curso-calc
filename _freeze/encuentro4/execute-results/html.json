{
  "hash": "8e34244b8f9217893df8e37e8b08669a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R para el tratamiento de Hojas de Cálculo\"\nsubtitle: \"Cuarto encuentro: Problemas comunes y ejemplos prácticos\"\ndate: \"2 de Diciembre, 2025\"\nauthor: \"Luis D. Verde Arregoitia\"\nformat:\n  revealjs:\n    slide-number: true\n    theme: css/slides.scss\neditor: visual\n---\n\n## Resumen del curso hasta ahora\n\n- Introducción a hojas de cálculo y buenas prácticas\n- Listas e iteración para trabajar con múltiples archivos\n- Importación y exportación de datos\n- Trabajo con archivos en la nube y formato\n\n## Objetivos de hoy\n\n- Resolver problemas comunes con hojas de cálculo\n- Analizar ejemplos reales\n- Explorar recursos útiles\n- Discutir estrategias avanzadas\n\n## Resolviendo problemas comunes\n\nLos desafíos más frecuentes al trabajar con hojas de cálculo incluyen:\n\n- Formatos de fecha inconsistentes\n- Encabezados problemáticos\n- Disposiciones irregulares de datos\n- Valores faltantes o inconsistentes\n- Combinación de múltiples fuentes\n\n## Trabajando con fechas\n\nLas fechas son notoriamente difíciles de manejar en hojas de cálculo:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Importar datos con fechas\nlibrary(readxl)\ndatos <- read_excel(\"datos_fechas.xlsx\", \n                    col_types = c(\"date\", \"text\", \"numeric\"))\n\n# Formateo de fechas con lubridate\nlibrary(lubridate)\nfechas_arregladas <- mdy(datos$fecha_texto)  # Mes-día-año\nfechas_arregladas2 <- dmy(datos$fecha_texto) # Día-mes-año\nfechas_arregladas3 <- ymd(datos$fecha_texto) # Año-mes-día\n```\n:::\n\n\n## Problemas comunes con fechas\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Conversión de números de Excel a fechas R\nfechas_excel <- as.Date(datos$numero_excel, origin = \"1899-12-30\")\n\n# Extracción de componentes de fecha\nlibrary(dplyr)\ndatos <- datos %>% \n  mutate(\n    año = year(fecha),\n    mes = month(fecha),\n    dia = day(fecha),\n    dia_semana = wday(fecha, label = TRUE)\n  )\n```\n:::\n\n\n## Encabezados problemáticos\n\nProblemas comunes:\n- Espacios o caracteres especiales\n- Múltiples filas de encabezados\n- Nombres duplicados\n- Celdas combinadas\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Limpiar nombres de columnas\nlibrary(janitor)\ndatos_limpios <- clean_names(datos)\n\n# Especificar manualmente los nombres\ncolnames(datos) <- c(\"id\", \"nombre\", \"valor\", \"fecha\")\n\n# Saltar filas iniciales y especificar nombres\ndatos <- read_excel(\"archivo.xlsx\", \n                    skip = 3, \n                    col_names = c(\"id\", \"nombre\", \"valor\", \"fecha\"))\n```\n:::\n\n\n## Manejo de múltiples filas de encabezados\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Leer encabezados compuestos\nencabezados <- read_excel(\"datos_complejos.xlsx\", \n                         n_max = 2)\n\n# Combinar encabezados\nnombres_combinados <- paste(\n  encabezados[1, ], \n  encabezados[2, ], \n  sep = \"_\"\n)\n\n# Leer el archivo con encabezados combinados\ndatos <- read_excel(\"datos_complejos.xlsx\", \n                    skip = 2, \n                    col_names = nombres_combinados)\n```\n:::\n\n\n## Disposiciones irregulares de los datos\n\nProblemas comunes:\n- Tablas con filas de subtotales o resúmenes\n- Múltiples tablas en una hoja\n- Filas en blanco con significado\n- Estructuras pivotadas incorrectamente\n\n## Manejo de datos con estructuras irregulares\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Eliminar filas de subtotales\ndatos <- datos %>% \n  filter(!str_detect(descripcion, \"Total|Subtotal\"))\n\n# Extraer una tabla específica de una hoja\ntabla1 <- read_excel(\"archivo.xlsx\", \n                     range = \"A5:F20\")\n\ntabla2 <- read_excel(\"archivo.xlsx\", \n                     range = \"A25:F40\")\n```\n:::\n\n\n## Tratamiento de datos pivotados incorrectamente\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convertir datos de formato ancho a largo\nlibrary(tidyr)\ndatos_largos <- datos %>%\n  pivot_longer(\n    cols = -c(id, categoria),\n    names_to = \"mes\",\n    values_to = \"valor\"\n  )\n\n# Convertir datos de formato largo a ancho\ndatos_anchos <- datos_largos %>%\n  pivot_wider(\n    names_from = mes,\n    values_from = valor\n  )\n```\n:::\n\n\n## Manejo de valores faltantes\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Identificar valores faltantes\nlibrary(naniar)\nmiss_var_summary(datos)\n\n# Filtrar o reemplazar valores faltantes\ndatos %>% filter(!is.na(valor))\n\n# Imputación de valores faltantes\ndatos <- datos %>%\n  mutate(valor = if_else(is.na(valor), \n                         mean(valor, na.rm = TRUE), \n                         valor))\n```\n:::\n\n\n## Ejemplos reales: Caso 1 - Datos de ventas\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Problema: Archivo de ventas con múltiples pestañas mensuales\n# y formatos inconsistentes\n\n# Solución:\nlibrary(tidyverse)\nlibrary(readxl)\n\n# 1. Identificar todas las pestañas\npestanas <- excel_sheets(\"ventas_anuales.xlsx\")\n\n# 2. Función para procesar cada pestaña\nprocesar_pestana <- function(sheet_name) {\n  # Leer los datos saltando encabezados irrelevantes\n  datos_crudos <- read_excel(\"ventas_anuales.xlsx\", \n                             sheet = sheet_name, \n                             skip = 3)\n  \n  # Limpiar nombres de columnas\n  datos_limpios <- clean_names(datos_crudos)\n  \n  # Eliminar filas de resumen\n  datos_filtrados <- datos_limpios %>%\n    filter(!is.na(codigo_producto), \n           !str_detect(producto, \"Total\"))\n  \n  # Agregar columna de mes\n  datos_filtrados %>%\n    mutate(mes = sheet_name)\n}\n\n# 3. Aplicar la función a todas las pestañas y combinar\ndatos_combinados <- pestanas %>%\n  map_dfr(procesar_pestana)\n```\n:::\n\n\n## Ejemplos reales: Caso 2 - Datos gubernamentales\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Problema: Reportes de presupuesto con encabezados\n# compuestos y múltiples niveles jerárquicos\n\n# Solución:\n# 1. Leer encabezados\nencabezados <- read_excel(\"presupuesto.xlsx\", n_max = 2)\nencabezados_combinados <- paste(encabezados[1, ], encabezados[2, ], sep = \"_\")\nencabezados_combinados <- make.names(encabezados_combinados)\n\n# 2. Leer datos con nuevos encabezados\ndatos <- read_excel(\"presupuesto.xlsx\", \n                    skip = 2, \n                    col_names = encabezados_combinados)\n\n# 3. Extraer información jerárquica\ndatos_procesados <- datos %>%\n  # Identificar niveles jerárquicos\n  mutate(\n    nivel = case_when(\n      !is.na(codigo_nivel_1) & is.na(codigo_nivel_2) ~ 1,\n      !is.na(codigo_nivel_2) & is.na(codigo_nivel_3) ~ 2,\n      !is.na(codigo_nivel_3) ~ 3,\n      TRUE ~ NA_real_\n    )\n  ) %>%\n  # Llenado hacia abajo para categorías jerárquicas\n  fill(categoria_nivel_1) %>%\n  # Filtrar solo registros de nivel 3 (detalle)\n  filter(nivel == 3)\n```\n:::\n\n\n## Ejemplos reales: Caso 3 - Informes médicos\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Problema: Datos de pacientes con fechas en formatos \n# inconsistentes y valores faltantes\n\n# Solución:\n# 1. Leer los datos y estandarizar formatos de fecha\ndatos_pacientes <- read_excel(\"pacientes.xlsx\")\n\ndatos_estandarizados <- datos_pacientes %>%\n  mutate(\n    # Convertir fechas de texto a fecha\n    fecha_nacimiento = case_when(\n      str_detect(fecha_nacimiento_raw, \"/\") ~ dmy(fecha_nacimiento_raw),\n      str_detect(fecha_nacimiento_raw, \"-\") ~ ymd(fecha_nacimiento_raw),\n      TRUE ~ as.Date(as.numeric(fecha_nacimiento_raw), origin = \"1899-12-30\")\n    ),\n    \n    # Calcular edad\n    edad = as.numeric(difftime(Sys.Date(), fecha_nacimiento, units = \"days\") / 365.25),\n    \n    # Crear grupos de edad\n    grupo_edad = case_when(\n      edad < 18 ~ \"Menor\",\n      edad < 65 ~ \"Adulto\",\n      TRUE ~ \"Adulto mayor\"\n    )\n  )\n\n# 2. Imputar valores faltantes en mediciones\ndatos_completos <- datos_estandarizados %>%\n  group_by(grupo_edad, sexo) %>%\n  mutate(\n    peso = if_else(is.na(peso), mean(peso, na.rm = TRUE), peso),\n    altura = if_else(is.na(altura), mean(altura, na.rm = TRUE), altura)\n  ) %>%\n  ungroup()\n```\n:::\n\n\n## Recursos útiles\n\n### Paquetes destacados\n\n- `readxl`, `openxlsx`: Importación/exportación de Excel\n- `googlesheets4`: Trabajo con Google Sheets\n- `tidyxl`, `unpivotr`: Manejo de hojas con formato complejo\n- `janitor`: Limpieza de datos y nombres de columnas\n- `lubridate`: Manejo de fechas\n- `naniar`: Análisis de datos faltantes\n\n## Recursos útiles (continuación)\n\n### Documentación y tutoriales\n\n- [R for Data Science (2e)](https://r4ds.hadley.nz/)\n- [Documentación de readxl](https://readxl.tidyverse.org/)\n- [Importando datos en tidyverse](https://www.tidyverse.org/blog/2020/01/usethis-1-5-0/)\n- [Working with Spreadsheets](https://datacarpentry.org/spreadsheets-socialsci/)\n- [openxlsx Vignettes](https://ycphs.github.io/openxlsx/)\n\n## Consejos finales\n\n- Verificar siempre los datos importados (primeras y últimas filas)\n- Documentar el procesamiento de datos\n- Utilizar funciones para tareas repetitivas\n- Crear flujos de trabajo reproducibles\n- Considerar la creación de paquetes para organizaciones\n\n## Discusión\n\n- ¿Qué desafíos específicos enfrentan con sus hojas de cálculo?\n- ¿Qué técnicas han encontrado útiles?\n- ¿Cómo podemos mejorar la colaboración entre usuarios de Excel y R?\n- ¿Qué temas les gustaría explorar con más profundidad?\n\n## ¡Gracias por participar!\n\nLuis D. Verde Arregoitia  \n[luis@liomys.mx](mailto:luis@liomys.mx)\n\nRecursos adicionales disponibles en el sitio del curso:  \n[Materiales del curso](materiales.qmd)",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}