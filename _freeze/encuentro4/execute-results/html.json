{
  "hash": "d546b2b2063656a40cb90a89bd2d6c5e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R para el tratamiento de Hojas de C치lculo\"\nsubtitle: \"Cuarto encuentro: Problemas comunes y ejemplos pr치cticos\"\ndate: \"02/12/2025\"\nauthor: \"Luis D. Verde Arregoitia\"\nformat:\n  revealjs:\n    slide-number: true\n    theme: css/slides.scss\neditor: visual\n---\n\n## Resumen del curso hasta ahora\n\n- Introducci칩n a hojas de c치lculo y buenas pr치cticas\n- Listas e iteraci칩n para trabajar con m칰ltiples archivos\n- Importar y exportar de datos\n- Trabajo con archivos en la nube\n- Archivos con formato de celda\n\n## Objetivos de hoy\n\n- Resolver problemas comunes con hojas de c치lculo\n- Limpiar ejemplos reales\n\n## Paquetes para hoy\n\n- `janitor`: Limpieza de datos\n- `lubridate`: Manejo de fechas\n- `tidyr`: Transformaci칩n de datos\n- `dplyr`: Manipulaci칩n de datos\n- `unheadr`: Manejo de encabezados complejos y formato de celdas\n- `stringr`: Manipulaci칩n de cadenas de texto\n\n## Resolviendo problemas comunes\n\nLos desaf칤os m치s frecuentes al trabajar con hojas de c치lculo incluyen:\n\n- Formatos de fecha inconsistentes\n- Encabezados problem치ticos\n- Disposiciones irregulares de datos\n- Valores faltantes o inconsistentes\n- Combinaci칩n de m칰ltiples fuentes\n\n## Trabajando con fechas\n\nLas fechas suelen causar confusi칩n al manejar hojas de c치lculo en R  \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\nread_excel(\"hojs/fechasx.xlsx\",sheet=2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 칑 3\n  Sitio Fecha               FechaNum\n  <chr> <dttm>                 <dbl>\n1 A     2024-12-07 00:00:00    45633\n2 A     2024-10-08 00:00:00    45573\n3 C     2024-11-08 00:00:00    45604\n4 A     2024-10-08 00:00:00    45573\n5 A     2023-07-07 00:00:00    45114\n6 B     2025-07-11 00:00:00    45849\n```\n\n\n:::\n:::\n\n\n## 쯈u칠 pas칩?\n\n. . .\n\nExcel a veces guarda las fechas como n칰meros seriales contando el 1ro de enero de 1900 (o a veces 1904) como d칤a 0. Depende del formato de celda en el archivo de inter칠s.\n\n## janitor 游뿪\n\nHerramientas para limpiar tablas desordenadas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(janitor)\nexcel_numeric_to_date(45573)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2024-10-08\"\n```\n\n\n:::\n:::\n\n\nLas fechas tienen su propia clase en R y se pueden manejar con R base o con el paquete `lubridate`.\n\n## Encabezados problem치ticos\n\nProblemas comunes:  \n- Espacios o caracteres especiales  \n- M칰ltiples filas de encabezados  \n- Nombres duplicados  \n- Celdas combinadas\n\n## Homogenizaci칩n de nombres de columnas\n\n`clean_names()` de `janitor` nos ayuda a limpiar todos los nombres de las columnas\n\n::: {.cell}\n\n```{.r .cell-code}\n# Limpiar nombres de columnas\nlibrary(janitor)\nread_excel(\"hojs/gwater.xlsx\") |> clean_names()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 칑 3\n  sitio cambio_permeabilidad litros_extraidos\n  <chr>                <dbl>            <dbl>\n1 A                      120              814\n2 A                      139              561\n3 B                      331               77\n4 C                      267              613\n5 C                      133               89\n6 D                      157              756\n```\n\n\n:::\n:::\n\n\n\n## Encabezados multi-fila\n\n\n::: {.cell}\n\n```{.r .cell-code}\nread_excel(\"hojs/encab.xlsx\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 칑 3\n  Especie Peso   Longitud\n  <chr>   <chr>  <chr>   \n1 <NA>    en     en      \n2 <NA>    gramos mm      \n3 A       34     170     \n4 B       33     182     \n5 C       29     166     \n6 D       31     179     \n```\n\n\n:::\n:::\n\n\nSe introducen NAs y aparecen fragmentos de encabezados en las filas que deber칤an contener datos.\n\n## Soluci칩n con unheadr\n\n`mash_colnames()` combina m칰ltiples filas de encabezados en nombres 칰nicos. Especificamos cu치ntas filas tienen fragmentos de encabezado.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(unheadr)\nread_excel(\"hojs/encab.xlsx\") |>\n  mash_colnames(n_name_rows =  2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 칑 3\n  Especie Peso_en_gramos Longitud_en_mm\n  <chr>   <chr>          <chr>         \n1 A       34             170           \n2 B       33             182           \n3 C       29             166           \n4 D       31             179           \n```\n\n\n:::\n:::\n\n\n## Valores faltantes\n\nPor defecto -> celdas vac칤as o especificar con `na=` al momento de importar.\n\n::: {.cell}\n\n```{.r .cell-code}\nread_excel(\"hojs/gwaterNA.xlsx\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 칑 3\n  Sitio `Cambio permeabilidad` `Litros extraidos`\n  <chr> <chr>                  <chr>             \n1 A     120                    814               \n2 A     139                    561               \n3 FALTA 331                    77                \n4 C     FALTA                  613               \n5 C     133                    FALTA             \n6 D     157                    756               \n```\n\n\n:::\n:::\n\n\n##\n\n\n::: {.cell}\n\n```{.r .cell-code}\nread_excel(\"hojs/gwaterNA.xlsx\",na=\"FALTA\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 칑 3\n  Sitio `Cambio permeabilidad` `Litros extraidos`\n  <chr>                  <dbl>              <dbl>\n1 A                        120                814\n2 A                        139                561\n3 <NA>                     331                 77\n4 C                         NA                613\n5 C                        133                 NA\n6 D                        157                756\n```\n\n\n:::\n:::\n\n\nA posteriori, podemos usar `na_if()` de `dplyr`\n\n## Ejemplo real: Veterinaria\n\nArchivo: `mascotas2.xlsx`  \n\nDos hojas, m칰ltiples problemas:  \n- Encabezados multi-fila  \n- Fechas en formatos inconsistentes  \n- Valores faltantes  \n- Informaci칩n guardada 칰nicamente en formato  \n- Informaci칩n relacionada en las dos hojas  \n\n## Ejemplo real: Veterinaria (continuaci칩n)\n\nFunciones de `dplyr` para manejo de datos. Materiales 칰tiles [aqu칤](https://luisdva.github.io/R-biodiversidad-2025/materiales.html)  \n\n* `mutate` para crear columnas nuevas  \n* `str_detect` de stringr para buscar patrones en texto (detectar los indicadores de formato) \n* Funciones join para juntar tablas  \n\n\n## Recursos 칰tiles\n\n### Paquetes destacados\n\n- `readxl` Importar desde Excel\n- `googlesheets4`: Trabajo con Google Sheets\n- `tidyxl`, `unpivotr`, `unheadr`: Manejo de hojas con formato \n- `janitor`: Limpieza de datos y nombres de columnas\n- `lubridate`: Manejo de fechas\n- `naniar`: An치lisis de datos faltantes\n\n## Recursos 칰tiles (continuaci칩n)\n\n### Documentaci칩n y tutoriales\n\n- [R for Data Science (2e)](https://r4ds.hadley.nz/)\n- [Documentaci칩n de readxl](https://readxl.tidyverse.org/)\n- [Working with Spreadsheets, The Carpentries](https://datacarpentry.org/spreadsheets-socialsci/)\n\n## Consejos finales\n\n- Verificar siempre los datos importados (en Excel y en data frame)\n- Documentar el procesamiento de datos\n- Utilizar funciones para tareas repetitivas\n- Crear flujos de trabajo reproducibles\n\n## Discusi칩n\n\n- 쯈u칠 desaf칤os espec칤ficos enfrentan con sus hojas de c치lculo?\n- 쯈u칠 t칠cnicas han encontrado 칰tiles?\n- 쮺칩mo podemos mejorar la colaboraci칩n entre usuarios de Excel y R?\n- 쯈u칠 temas les gustar칤a explorar con m치s profundidad?\n\n# 춰Gracias por participar!\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}