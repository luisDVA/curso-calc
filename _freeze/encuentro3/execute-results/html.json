{
  "hash": "f7d52be3a8e053cb0ef00f74341eae5b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R para el tratamiento de Hojas de Cálculo\"\nsubtitle: \"Tercer encuentro: Archivos en la nube y formato\"\ndate: \"25 de Noviembre, 2025\"\nauthor: \"Luis D. Verde Arregoitia\"\nformat:\n  revealjs:\n    slide-number: true\n    theme: css/slides.scss\neditor: visual\n---\n\n## Resumen del encuentro anterior\n\n- Listas e iteración en R\n- Trabajo con múltiples archivos o pestañas\n- Exportación de datos a Excel\n- Operaciones comunes con dataframes\n\n## Objetivos de hoy\n\n- Conectar R con Google Sheets\n- Leer y escribir datos en hojas de cálculo en la nube\n- Trabajar con formato de celdas\n- Importar hojas con formato conservando su estructura\n\n## Trabajo con archivos en la nube (Google Sheets)\n\n### Ventajas\n\n- Acceso desde cualquier dispositivo\n- Colaboración en tiempo real\n- Control de versiones\n- Integración con otros servicios de Google\n- Automatización de tareas\n\n## Inicio de sesión y conexión con la API de Google\n\n### Instalación de paquetes necesarios\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Instalar paquetes\ninstall.packages(c(\"googlesheets4\", \"googledrive\"))\n\n# Cargar paquetes\nlibrary(googlesheets4)\nlibrary(googledrive)\n```\n:::\n\n\n## Autenticación con Google\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Autenticación con interacción del usuario\ngs4_auth()\ndrive_auth()\n\n# También es posible autenticar con un archivo de credenciales\ngs4_auth(path = \"tu_archivo_credenciales.json\")\n\n# O usar un token guardado previamente\ngs4_auth(token = \"token.rds\")\n```\n:::\n\n\n## Accediendo a hojas de Google Sheets\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Listar hojas de cálculo disponibles\nmis_sheets <- gs4_find()\n\n# Acceder por URL\ndatos <- read_sheet(\"https://docs.google.com/spreadsheets/d/abc123...\")\n\n# Acceder por ID\nid_sheet <- \"abc123...\"\ndatos <- read_sheet(id_sheet)\n\n# Acceder a una hoja específica\ndatos <- read_sheet(id_sheet, sheet = \"Ventas\")\n```\n:::\n\n\n## Trabajando con pestañas específicas\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Obtener nombres de las pestañas\nsheet_names <- sheet_names(id_sheet)\n\n# Leer múltiples pestañas\nall_sheets <- sheet_names %>%\n  purrr::set_names() %>%\n  purrr::map(~read_sheet(id_sheet, sheet = .x))\n\n# Leer rangos específicos\ndatos_rango <- read_sheet(id_sheet, \n                         sheet = \"Ventas\",\n                         range = \"A1:D20\")\n```\n:::\n\n\n## Escribiendo datos a Google Sheets\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Crear una nueva hoja de cálculo\nnuevo_sheet <- gs4_create(\"Nuevo análisis\")\n\n# Escribir datos a una hoja existente\nwrite_sheet(datos, ss = id_sheet, sheet = \"Nueva pestaña\")\n\n# Actualizar datos existentes\nsheet_write(datos_actualizados, \n            ss = id_sheet, \n            sheet = \"Datos\")\n```\n:::\n\n\n## Archivos en Sheets y Drive\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Listar archivos en Drive\nmis_archivos <- drive_find(type = \"spreadsheet\")\n\n# Buscar un archivo específico\narchivo <- drive_find(pattern = \"Ventas 2025\")\n\n# Descargar un archivo\ndrive_download(archivo, path = \"ventas_local.xlsx\")\n\n# Compartir un archivo\ndrive_share(archivo, role = \"reader\", \n            type = \"anyone\", emailAddress = \"usuario@example.com\")\n```\n:::\n\n\n## Integración de Sheets con dplyr\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\n# Leer datos de Google Sheets\ndatos_ventas <- read_sheet(id_sheet, sheet = \"Ventas\")\n\n# Aplicar operaciones dplyr\nresultados <- datos_ventas %>%\n  filter(region == \"Norte\") %>%\n  group_by(producto) %>%\n  summarize(total_ventas = sum(ventas, na.rm = TRUE)) %>%\n  arrange(desc(total_ventas))\n\n# Escribir resultados de vuelta a Google Sheets\nwrite_sheet(resultados, ss = id_sheet, sheet = \"Resultados\")\n```\n:::\n\n\n## Trabajando con formato en celdas o texto\n\n### Desafíos comunes con formato\n\n- Colores de fondo o texto que representan información\n- Celdas combinadas\n- Alineación específica de datos\n- Fuentes o tamaños de texto significativos\n- Bordes que denotan agrupaciones\n\n## Importando hojas con formato\n\nEl paquete `openxlsx` permite conservar y manipular formato:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(openxlsx)\n\n# Leer un archivo Excel preservando el formato\nwb <- loadWorkbook(\"datos_con_formato.xlsx\")\n\n# Obtener hojas disponibles\nsheets <- getSheetNames(\"datos_con_formato.xlsx\")\n\n# Leer una hoja específica como dataframe\ndatos <- read.xlsx(wb, sheet = 1)\n```\n:::\n\n\n## Detectando celdas con formato en Excel\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Obtener información de estilo de celda\nestilos <- getStyles(wb)\n\n# Verificar celdas con formato específico\nceldas_rojas <- getCellStyle(wb, sheet = 1, rows = 1:10, cols = 1:5)\n\n# Identificar celdas con fondo rojo (para análisis posterior)\nfor (i in 1:length(celdas_rojas)) {\n  if (!is.null(celdas_rojas[[i]]$fill$fillFg) && \n      celdas_rojas[[i]]$fill$fillFg == \"#FF0000\") {\n    # Procesar estas celdas de forma especial\n    print(paste(\"Celda con fondo rojo encontrada en posición:\", i))\n  }\n}\n```\n:::\n\n\n## Creando informes con formato personalizado\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Crear un libro de trabajo\nwb <- createWorkbook()\naddWorksheet(wb, \"Informe\")\n\n# Escribir datos\nwriteData(wb, \"Informe\", datos)\n\n# Definir estilos\nestilo_encabezado <- createStyle(\n  fontColour = \"#FFFFFF\", fontSize = 12,\n  fgFill = \"#8BC34A\", textDecoration = \"bold\",\n  halign = \"center\", border = \"TopBottom\"\n)\n\nestilo_numerico <- createStyle(\n  numFmt = \"#,##0.00\", \n  halign = \"right\"\n)\n\n# Aplicar estilos\naddStyle(wb, \"Informe\", estilo_encabezado, \n         rows = 1, cols = 1:ncol(datos))\n\n# Aplicar formato condicional\nconditionalFormatting(wb, \"Informe\", \n                     cols = 3, \n                     rows = 2:(nrow(datos) + 1),\n                     rule = \"$C2>1000\", \n                     style = createStyle(fgFill = \"#AED581\"))\n```\n:::\n\n\n## Extrayendo información de celdas con formato\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyxl)\nlibrary(unpivotr)\n\n# Importar Excel preservando formato\nceldas <- xlsx_cells(\"datos_con_formato.xlsx\", sheets = \"Hoja1\")\n\n# Examinar celdas con formato específico\nceldas_con_color <- celdas %>%\n  filter(!is.na(fill_color))\n\n# Extraer datos estructurados de celdas con formato\ndatos_estructurados <- celdas %>%\n  filter(row >= 5, col >= 3, col <= 7) %>%\n  select(row, col, character, numeric, formula, is_blank) %>%\n  behead(\"up\", header) %>%\n  behead(\"left\", categoria)\n```\n:::\n\n\n## Generando informes con estilo consistente\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Función para aplicar un estilo consistente a informes\ncrear_informe_estilo <- function(datos, nombre_archivo) {\n  wb <- createWorkbook()\n  addWorksheet(wb, \"Informe\")\n  \n  writeData(wb, \"Informe\", datos)\n  \n  # Aplicar estilos corporativos\n  addStyle(wb, \"Informe\", estilo_corporativo_header(), \n           rows = 1, cols = 1:ncol(datos))\n  \n  # Ajustar ancho de columnas\n  setColWidths(wb, \"Informe\", cols = 1:ncol(datos), \n               widths = \"auto\")\n  \n  # Guardar archivo\n  saveWorkbook(wb, nombre_archivo, overwrite = TRUE)\n}\n```\n:::\n\n\n## Para el próximo encuentro...\n\n- Resolveremos problemas comunes con hojas de cálculo:\n  - Manejo de fechas\n  - Encabezados problemáticos\n  - Disposiciones irregulares de datos\n- Analizaremos ejemplos reales\n- Discutiremos recursos útiles y mejores prácticas\n\n### Ejercicio sugerido\nConecten R con una hoja de Google Sheets y practiquen la lectura/escritura de datos.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}